
<html>
  <head><title>Processing human players' transcripts for Mann-Whitney comparison</title>
  </head>
<body>

<h1>Processing human players' transcripts for Mann-Whitney comparison</h1>

<div align="center"><em>Updated 2023-01-16, for Game Server 6.005</em></div>

<p>This document desribes the functionality of the script <tt>scripts/analyze-transcripts-mwh.sh</tt>, which is designed to analyze human players' transcripts in order to compare rule sets with respect to their ease/difficulty for the human players' population.

<p>This command-line script accesses the same functionality as the <a href="mw-human-form.jsp">web interface</a>, but also has some additional functionality which allows you to separate the stages of transcript analysis and M-W comparison.

<!--
  header="#ruleSetName,precedingRules,"+
  "exp,trialListId,seriesNo,playerId,
  learned,total_moves,total_errors,mStar";

  "#ruleSetName - use
  ,precedingRules - can ignore depending on precMode
  "exp,trialListId,seriesNo,playerId, - not used
  "learned,total_moves,total_errors, -- used for extra stats
  mStar" - use
  -->

  <h2>Usage</h2>

<p>There are 3 modes:
  <ol>
    <li>You can extract the data from the transcripts and the database and use them for the M-W comparison of rule sets right away.
    <li>You can perform the extraction and save the data (<tt>-export</tt>) for later post-processing by your own tools.
    <li>You can import (<tt>-import</tt>) data that you have prepared using your own tools, and use the for the M-W comparison.
  </ol>

These modes are discussed below.
  
  <h3>(1) Extracting data from transcripts, and using them for M-W test.</h3>

  You just need to specify the names of the experiment plans. All transcripts of players assigned to those plans will be used in the analysis; the M-W compaison will include or rule sets (or, more, precisely, "experiences") experinced by these players.

  <p>(The script is actually in <tt>/home/vmenkov/w2022/game/scripts</tt> on sapir; so you can add that directory to your PATH, or just type the full path).

    <pre>scripts/analyze-transcripts-mwh.sh  <em>[extractionOptions] [MWOptons] [otherOptions] data_selector</em>
</pre>
    where <em>data_selector</em> specifies the set of transcripts to extract, and  <em>options</em> specify the mode of processing.
</p>


   <h4>Data selection</h4>
<p>There are several data selection modes, illustrated below. They are exactly the same as for the original <a href="../analyze-transcripts.html">Analyze Transcript</a> tool.

  <p>
  To save space, the script name in the examples below is given without the full path, which in reality you will need to indicate (unless you simply add the scripts directory to your PATH, of course). 

  <h5>(A) Select by experiment plan name</h5>
  <pre>analyze-transcripts-mwh.sh <em>[options] plan1 [plan2...]</em>  </pre>
   e.g.
  <pre>analyze-transcripts-mwh.sh pilot06  </pre>
  or
  <pre>analyze-transcripts-mwh.sh '%OCT26%'  </pre>

<p>
(You can also write <code>analyze-transcripts.sh -plan '%OCT26%'</code>, but the <tt>-plan</tt> option is unnecessary, since selection by plan name is the default selection method). 

<p>
As the above example shows, the percent character can be used for wildcard-based selection, to select all matching plans. The percent sign can also be used in all other selectors discussed below.  (We use <tt>%</tt> rather than <tt>*</tt> because that's what used in the SQL server. It also avoids certain problems with  command line processing).

<p>Specifying an experiment plan is equivalent to specifying a list of player IDs (see 2 below) that includes all player IDs assigned to that experiment plan.

    <h5>(B) Select by player IDs</h5>

<p>In the Rule Game Server, a player ID corresponds to a round of one or several series of episodes played according to a particular trial list. An M-Turker has a single player id, while a repeat user may have multiple ones.
  <pre>analyze-transcripts-mwh.sh -pid <em>playerId1 [playerId2 ...]</em>  </pre>
  E.g.
  <pre>analyze-transcripts-mwh.sh -pid 'pk%'  </pre>
or
  <pre>analyze-transcripts-mwh.sh -pid 'RepeatUser-%'  </pre>
(The second examples picks all player IDs created by GS4's repeat users, since that's what their player IDs look like).      

  <h5>(C) Select by repeat user ID</h5>

<P>Internally, repeat users are identified by unique user IDs. (You can see IDs for various player e.g. by logging in to the SQL server with <tt>mysql</tt> and issuing commands such as
  <Pre>use game;
select * from User;  </pre>

<p>
  One can pass a list of user IDs to the Analyze Transcript tool as well, as follows:
  <pre>analyze-transcripts-mwh.sh -uid <em>uid1 [uid2 ...]</em>  </pre>
  E.g.
  <pre>analyze-transcripts-mwh.sh -uid 2 3 6  </pre>
</p>

<p>Selecting data by specifying a repeat user ID is equivalent to selecting by player ID and listing all player IDs associated with that repeat user.
    	 
<h5>(D) Select by repeat user nickname</h5>

<p>A repeat created via the login screen may have a nickname. You can see the nicknames of repeat users with the same SQL command. The Analyze Transcript tool can take a list of user nicknames instead of a list of user IDs, e.g.  
  <pre>analyze-transcripts-mwh.sh -nickname 'John%Doe' '%Walrus%'  </pre>


<p>Note that one should not use spaces inside command-line arguments. If your nickname has a space inside it, you may use a percent sign (%) on the command line above instead.  
</p>

<h4>Extraction options</h4>

<p>These options control how the raw transcript data are converted into (player,experience) entries.

  <ul>
    <li><tt>-targetStreak 10</tt> : this is how many consecutive error-free moves the player must make in order to demonstrate successful learning.
    <li><tt>-defaultMStar 300</tt> : this value the program will assign as <em>m<sub>*</sub></em> (mStar) to the players who have failed to learn (as per the above criterion) the rule set they were playing. You can use the value <tt>Infinity</tt> to ensure that all non-learners are distinct from all learners; however, any positive value that's larger than the maximum number of moves in any player's series will work just as well. Because M-W is based on comparisons, 300 will work exactly the same way as  <tt>Infinity</tt> as long as no successful player has put more than 300 move attempts into any rule set.
  </ul>

<p>Other options:
  <ul>
    <li><tt>-file</tt> : if this option is used, then instead of listing plan names (or player IDs, etc) on the command line, you can put them into a file (one name perl line), and put that file name's on the command line. This may be handy if you want to look at data from a large number of plans.
  </ul>

  <h4>M-W options</h4>

<p>These options affect the way the (player,experience) entries are used  for the M-W-based ranking of rule sets.
  
  <ul>
    <li><tt>-mDagger</tt>: if this option is supplied, the M-W computation will be based on the mDagger values, rather than mStar. Unlike the normal (mStar) mode, players who have not learned any of their rule sets (and therefore have mDagger=NaN) will be ignored in the M-W computation.
    
    
    <li><tt>-precMode [Naive | Every | Ignore]</tt> : This controls how different series are assigned to different "experiences" to be compared. This is how the 3 modes work:
      <ul>
	<li><tt>Naive</tt> (the default mode): For each rule sets, only include "naive" players (those who played this rule set as their first rule set). In other word, if a player played 3 rules sets, R1, R2, and R3, in this order, then only his experience of playing R1 is analyzed.
<li><tt>Every</tt> Consider each (rule set + preceding set) combination as a separate experience to be ranked. (That is,
the R1 data from <strong>R1</strong>:R2:R3,  
R2:<strong>R1</strong>:R3, and
R2:R3:<strong>R1</strong> are viewed as belonging to three distinct experiences, "R1", "R2:R1", and "R2:R3:R1")
<li><tt>Ignore</tt>Ignore: When viewing a rule set's series, ignore preceding rule sets. (In other words, the R1 data from
<strong>R1</strong>:R2:R3,  
R2:<strong>R1</strong>:R3, and
R2:R3:<strong>R1</strong> are merged, viewed as the same "R1 experience").
      </ul>
  </ul>

    <h3>(2) Extracting data from transcripts, and saving them to file.</h3>
  
<p>Use this mode if you want to post-process the mStar data. 

  <pre>scripts/analyze-transcripts-mwh.sh  <em>[extractionOptions] [MWOptions] [otherOptions]</em> -export outputFileName.csv <em>data_selector</em>
  </pre>

<p>The transcript data will be extracted in the same way as in (1), but, in addition to performing the M-W comparison, the extracted and processed data will also be saved in a CSV file to the specified. The program will also carry out the same M-W computations as in (1).

  <p>Therefore, the format of the command line is almost the same as in (1), with the addition of the <tt>-export</tt> option.

  <p>The output file will be in the following format:
  
<pre>
#ruleSetName,precedingRules,exp,trialListId,seriesNo,playerId,learned,total_moves,total_errors,mStar,mDagger
ep/1_1_color_4m,,ep/rule_ambiguity/ambiguity4,ambiguity4_4,0,A016079037TD5GXCNYBPH,false,99,47,300.0,300
ep/col_ord_rbyg_1_4,ep/1_1_color_4m,ep/rule_ambiguity/ambiguity4,ambiguity4_4,1,A016079037TD5GXCNYBPH,false,90,49,300.0,NaN
ep/shape_ord_SqCTSt_1_4,ep/1_1_color_4m;ep/col_ord_rbyg_1_4,ep/rule_ambiguity/ambiguity4,ambiguity4_4,2,A016079037TD5GXCNYBPH,false,98,58,300.0,NaN
ep/1_2_color_4m,,ep/rule_ambiguity/ambiguity4,ambiguity4_6,0,A10G8U9316K46H,false,52,16,300.0,NaN
   ...  ... ...
</pre>

<p>In the output file, each line (after the header line) corresponds to 1 series, i.e. the series of episodes played by one player against one rule set. The meaning of the columns is as follows:
  <ul>
    <li>ruleSetName - the rule set being played
    <li>precedingRules - the semicolon-separated list of rule sets, if any, this player played before encountering this rule set
    <li>exp,trialListId,seriesNo - the experiment plan, and the trial list within that plan, and the sequential number (0-based) of the rule set in the trial list
    <li>learned - "true" or "false" depending on whether the player has "demonstrated learning" in that series (i.e. managed to make the prescribed number [targetStreak] of consecutive error free moves)
    <li>total_moves - the total number of move and pick attempts in all episodes of the series
    <li>total_errors - the total number of failed move and pick attempts in the series
    <li>mStar - the number of errors (i.e. failed move and pick attempts) the player has made in this series before he "demonstrated learning", or the <em>defaultMStar</em> value (which can be <tt>infinity</tt>) if the learning was not demonstrated (or if it took more than <em>defaultMStar</em> errors to achieve learning).
      <li>mDagger(P,E) = mStar(P,E) - Avg(mStar(P,*)), where the everaging is over all experiences where player P successfully learned the rule. If P learned no rules at all, then mDagger is reported as <tt>NaN</tt> for all experiences of that player.
  </ul>
  
    <h3>(3) M-W computations with imported mStar data</h3>
  
<p>Use this mode if you want to carry out the M-W computations with mStar data that you have computed yourself, using other tools. (Those tools, of course, may consist of a simple <tt>perl</tt> or <tt>awk</tt> script post-processing the CSV file produced in (2)).


  <pre>scripts/analyze-transcripts-mwh.sh  <em>[MWOptions] [otherOptions]</em> -import inputFileName.csv
</pre>

<p>Note that while you cannot supply the extraction options in this mode, you can still supply M-W options (namely, <tt>-precMode</tt>).

<p>The input file can be in the exactly same format as the one used for the output file in (2). (Thus, your post-processing script may, for example, simply remove some data rows from the file, e.g. based on the playerId). However, if you produce the mStar data in a different way, you can choose to omit some columns. The only columns you must keep are <tt>ruleSetName</tt> and <tt>mStar</tt>.

<p>All other columns are optional. Specifically, if the <tt>precedingRules</tt> column is present, its content can be used together with the ruleSetName to qualify the experience (as per the <tt>-precMode</tt> option). If the columns <tt>learned,total_moves,total_errors</tt> are present, they will be used for various statistics in the report; if they are absent, the corresponding fields of the report table will be blank or zeros or similarly non-informative.


<p>If you want to compute the M-W matrix based on mDagger instead of mStar (using the -mDagger option), then of course the mDagger column also should be present. In this case the computation will ignore all entries where the value is NaN (or absent).
  
   <h3> Examples</h3>

  <p>1. Full-cycle analysis on the data from several experiment plans:
  <pre>scripts/analyze-transcripts-mwh.sh ep/rule_ambiguity/ambiguity1 ep/rule_ambiguity/ambiguity2 ep/rule_ambiguity/ambiguity3 ep/rule_ambiguity/ambiguity4
  </pre>

  <p>2. Take the input (precomputed mStar) from <tt>a.csv</tt>. Save the M-W results to files in directory <tt>tmp</tt> (which will be automatically created if it does not exist).
<pre>analyze-transcripts-mwh.sh -import a.csv -csvOut tmp</pre>



  
<h2>See also</h2>

    <ul>
      <li><a href="../data.html">Game Server's data</a>
      <li><a href="../analyze-transcripts.html">Processing human players' transcripts (main page)</a>
    </ul>
    

</body>
</html>
